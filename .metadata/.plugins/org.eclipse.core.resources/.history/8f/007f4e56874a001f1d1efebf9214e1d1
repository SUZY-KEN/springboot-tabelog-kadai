<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
	<div th:replace="~{fragment::meta}"></div>
	<div th:replace="~{fragment::scripts}"></div>
	<title>店舗詳細</title>
</head>

<body>

	<div th:replace="~{fragment::header}"></div>
	
	
	<main>
		
<!--パンくず	-->
		<nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
           <ol class="breadcrumb mb-0">                        
               <li class="breadcrumb-item"><a th:href="@{/}">ホーム</a></liclass="breadcrumb-item">
				<li class="breadcrumb-item"><a th:href="@{/restaurants}">店舗一覧</a></liclass="breadcrumb-item">
               <li class="breadcrumb-item" aria-current="page">店舗詳細</li>
           </ol>
       </nav>     
		
		
		
		
		
	   <!--店舗詳細-->	
		<div>
			<div th:if="${successMessage}" class="alert alert-info">
				<span th:text="${successMessage}"></span>
		   </div>
		   
			<h1 th:text="${restaurants.getName()}"></h1>
			
			
		<!--お気に入りボタン-->
			<a sec:authorize="hasRole('ROLE_MEMBERSHIP')" th:if="${isFavoriteRestaurant}" th:href="@{/favorite/__${restaurants.getId()}__/cancel}">&#9825;お気に入り解除</a		sec:authorize="hasRole(ROLE_MEMBERSHIP)">
			<a sec:authorize="hasRole('ROLE_MEMBERSHIP')"th:unless="${isFavoriteRestaurant}" th:href="@{/favorite/__${restaurants.getId()}__/register}">&#9829;お気に入り登録</a >
			
			<p th:if="${restaurants.getEvalues()}==0">&#9734;&#9734;&#9734;&#9734;&#9734;</p>
			<p th:if="${restaurants.getEvalues()}==1">&#9733;&#9734;&#9734;&#9734;&#9734;</p>
			<p th:if="${restaurants.getEvalues()}==2">&#9733;&#9733;&#9734;&#9734;&#9734;</p>
			<p th:if="${restaurants.getEvalues()}==3">&#9733;&#9733;&#9733;&#9734;&#9734;</p>
			<p th:if="${restaurants.getEvalues()}==4">&#9733;&#9733;&#9733;&#9733;&#9734;</p>
			<p th:if="${restaurants.getEvalues()}==5">&#9733;&#9733;&#9733;&#9733;&#9733;</p>
			
			
			<!--店舗ビュー-->
			<div>
				<!--イメージ後で作る-->
				<div>
					<img th:if="${restaurants.getImage()}" th:src="###"></img>
					<!--<img th:unless="${restaurant.getImage()}" th:src="###"></img>-->
				</div>
				
				<table>
					<tr>
						<th>店舗名</th>
						<td th:text="${restaurants.getName()}"></td>
					</tr>
					
					<tr>
						<th>価格</th>
						<td th:text="${#numbers.formatInteger(restaurants.getPrice(),1,'COMMA')+'円～'}"></td>
					</tr>
					
					<tr>
						<th>説明</th>
						<td th:text="${restaurants.getDescription()}"></td>
					</tr>
					
					<tr>
						<th>住所</th>
						<td th:text="${restaurants.getAddress()}"></td>
					</tr>
					
					<tr>
						<th>営業日</th>
						<td></td>
					</tr>
					
					
					<tr>
						<th>カテゴリ</th>
						<td th:text="${restaurants.getCategory().getName()}"></td>
					</tr>
					
				</table>
				
										
				
			</div>
				
			<!--予約フォーム-->
			<div>
				
			</div>
				
				
			
		</div>	
			
<!--レビュー-->


		
		<div>
			<h2 class="mb-4 text-center">レビュー</h2>
			
           	<div sec:authorize="hasRole('ROLE_MEMBERSHIP')" th:unless="${hasUserAlreadyReviewed}" class="row justify-content-center mb-4">
               <div class="col-lg-4">
                   <a th:href="@{/restaurants/__${restaurants.getId()}__/reviews/create}" >レビューを投稿する</a>
               </div>
          	 </div>
			 
	<!--未レビュー-->
			<div th:if="${#lists.isEmpty(newReviews)}" class="mb-4">                                    
                <p class="text-center">まだレビューがありません。</p>                                    
            </div>
		
<!--レビュー一覧-->
			<div th:unless="${#lists.isEmpty(newReviews)}" class="row row-cols-1 row-cols-md-2 g-4 mb-4">
				<div th:each="review : ${newReviews}">
                   <div class="col">
                       <div class="card">
                           <div class="card-body">
                               <div class="d-flex justify-content-between">
                                   <h5 class="card-title" th:text="${review.getUsers().getName()}"></h5>
								   
								   <!--編集削除-->
                                   <span sec:authorize="hasRole('ROLE_MEMBERSHIP')" th:if="${#authentication.principal.user.id == review.getUsers().getId()}">
									
                                       <a th:href="@{/restaurants/__${restaurants.getId()}__/reviews/__${review.getId()}__/edit}" class="me-2">編集</a>
                                       <a href="#" class="samuraitravel-link-danger" data-bs-toggle="modal" th:data-bs-target="${'#deleteReviewModal' + review.getId()}">削除</a>
									   
                                       <!-- 削除用モーダル -->
                                       <div class="modal fade" th:id="${'deleteReviewModal' + review.getId()}" tabindex="-1" th:aria-labelledby="${'deleteReviewModalLabel' + review.getId()}">
                                           <div class="modal-dialog">
                                               <div class="modal-content">
                                                   <div class="modal-header">
                                                       <h5 class="modal-title" th:id="${'deleteReviewModalLabel' + review.getId()}" th:text="${review.getRestaurants().getName()+ 'のレビューを削除してもよろしいですか？'}"></h5>
                                                       <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="閉じる"></button>
                                                   </div>
                                                   <div class="modal-footer">
                                                       <form method="post" th:action="@{/restaurants/__${restaurants.getId()}__/reviews/__${review.getId()}__/delete}">
                                                           <button type="submit" >削除</button>
                                                       </form>
                                                   </div>
                                               </div>
                                           </div>
                                       </div>                                                                                                            
                                   </span>      
                               </div>                                              
                               <p class="card-text mb-1">
                                   <span class="samuraitravel-star" th:each="star : ${#numbers.sequence(1, 5)}" th:text="${star <= review.getEvalue()} ? '&#9733;' : '&#9734;'"></span>
                               </p>                      
                               <p class="card-text"><small class="text-muted" th:text="${#dates.format(review.getCreatedAt(), 'yyyy年MM月dd日')}"></small></p>                              
                               <p class="card-text" th:text="${review.getReviewComment()}"></p>
                           </div>
                       </div>
                   </div>
               </div>                                     
            
         	  <div class="text-center mb-4" th:if="${totalReviewCount > 6}">
               <a th:href="@{/restaurants/__${restaurants.getId()}__/reviews}">すべてのレビューを見る</a>
          	 </div>                                                            
				
		</div>
	</div>		
			
		


	</main>
	
	
	<div th:replace="~{fragment::footer}"></div>
	
	<div th:replace="~{fragment::scripts}"></div>
</body>
</html>