<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
	<div th:replace="~{fragment::meta}"></div>
	<div th:replace="~{fragment::styles}"></div>
	<title>店舗一覧</title>
</head>

<body>

	<div th:replace="~{fragment::header}"></div>
	
	
	<main>
		
<!--パンくず	-->
		<nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
           <ol class="breadcrumb mb-0">                        
               <li class="breadcrumb-item"><a th:href="@{/}">ホーム</a></liclass="breadcrumb-item">
               <li class="breadcrumb-item" aria-current="page">民宿一覧</li>
           </ol>
       </nav>     
		
		
	   <div th:if="${successMessage}" class="alert alert-info">
	   		 				<span th:text="${successMessage}"></span>
	   	</div>
	   
<!--		管理者機能-->
		<div sec:authorize="hasRole('ROLE_ADMIN')">
			<form method="get" th:action="${/admin/restaurant/create}">
				<button	type="submit">新規登録</button>
			</form>

		</div>
		
		
<!--価格並び替え-->
		<div>
			<form method="get"th:action="@{/restaurants}" >
				<select name="price">
					<option value="" hidden>並び順を指定してください</option>
					<option th:value="1">価格の安い順</option>
					<option th:value="2">価格の高い順</option>
				</select>
				<input type="hidden" name="nameKeyword" th:value="${nameKeyword}" >
				<input type="hidden" name="category" th:value="${category}" >
				<button type="submit">並び替え</button>
			</form>
		</div>
		
		<div>
			
			
			
			<div>                                
	             <p th:if="${restaurantsPage.getTotalPages() > 1}" th:text="${'検索結果：' + restaurantsPage.getTotalElements() + '件' + '（' + (restaurantsPage.getNumber() + 1) + ' / ' + restaurantsPage.getTotalPages() + ' ページ）'}"></p> 
	             <p th:unless="${restaurantsPage.getTotalPages() > 1}" th:text="${'検索結果：' + restaurantsPage.getTotalElements() + '件'}"></p>                                 
	         </div> 

			
<!--各店舗情報-->
			<div th:each="restaurants:${restaurantsPage}">
				
				<a th:href="@{/restaurants/show/__${restaurants.getId()}__}">
					<div>
						<h3 th:text="${restaurants.getName()}" ></h3>
						
		<!--管理者編集・削除-->
						<div sec:authorize="hasRole('ROLE_ADMIN')">
							<span><a href="@{}">編集</a></span>
							<span><a>削除</a></span>
						</div>
		
						
		<!--イメージ後で作る-->
						<div>
							<img th:if="${restaurants.getImage()}" th:src="	@{/storage/__${restaurants.getImage}__}"></img>
							<img th:unless="${restaurants.getImage()}" th:src="@{/images/noImage.png}"></img>
						</div>
						
						<div>
							<p th:if="${restaurants.getCategory()!=null}" th:text="${restaurants.getCategory().getName()}"></p>
							
	<!--評価を平均して整数値に丸める仕組みは後でServiceに作る-->
	<!--評価-->
							<div th:if="${restaurants.getEvalues!=null}">	
								<p th:if="${restaurants.getEvalues()}==0">&#9734;&#9734;&#9734;&#9734;&#9734;</p>
								<p th:if="${restaurants.getEvalues()}==1">&#9733;&#9734;&#9734;&#9734;&#9734;</p>
								<p th:if="${restaurants.getEvalues()}==2">&#9733;&#9733;&#9734;&#9734;&#9734;</p>
								<p th:if="${restaurants.getEvalues()}==3">&#9733;&#9733;&#9733;&#9734;&#9734;</p>
								<p th:if="${restaurants.getEvalues()}==4">&#9733;&#9733;&#9733;&#9733;&#9734;</p>
								<p th:if="${restaurants.getEvalues()}==5">&#9733;&#9733;&#9733;&#9733;&#9733;</p>
							</div>
							
							<div th:unless="${restaurants.getEvalues!=null}">	
								<p>まだ評価がありません</p>
							</div>
							
	
							<p th:text="${'住所：'+restaurants.getAddress()}"></p>
							<p th:text="${#numbers.formatInteger(restaurants.getPrice(),1,'COMMA')+'円～'}"></p>
						</div>
					</div>
				</a>
				
				
			</div>
		</div>	
			
		<!--店舗ページネーション設定-->
		<div th:if="${restaurantsPage.getTotalPages()>1}" class="d-flex justify-content-center" >
			<nav aria-label="店舗一覧ページ">
				<ul class="pagination">
					<li class="page-item">
						<sapn th:if="${restaurantsPage.isFirst()}" class="page-link disabled">前</sapn>
						<a th:unless="${restaurantsPage.isFirst()}" th:href="@{/restaurants(page=${restaurantsPage.getNumber()-1},nameKeyword=${nameKeyword},category=${category},price=${price})}"	class="page-link nagoyameshi-page-link">前</a>
					</li>
					
					<li th:each="i : ${#numbers.sequence(0, restaurantsPage.getTotalPages() - 1)}" class="page-item">
                        <span th:if="${i == restaurantsPage.getNumber()}"  th:text="${i + 1}" class="page-link active nagoyameshi-active"></span>
                        <a th:unless="${i == restaurantsPage.getNumber()}" th:href="@{/restaurants(page = ${i},nameKeyword=${nameKeyword},category=${category},price=${price})}" th:text="${i + 1}" class="page-link nagoyameshi-page-link"></a>
                    </li>
					
					<li class="page-item">
						<sapn th:if="${restaurantsPage.isLast()}" class="page-link disabled">次</sapn>
						<a th:unless="${restaurantsPage.isLast()}" th:href="@{/restaurants(page=${restaurantsPage.getNumber()+1},nameKeyword=${nameKeyword},category=${category},price=${price})}" class="page-link nagoyameshi-page-link">次</a>
					</li>

					
				</ul>
				
			</nav>
			
		</div>


	</main>
	
	
	<div th:replace="~{fragment::footer}"></div>
	
	<div th:replace="~{fragment::scripts}"></div>
</body>
</html>